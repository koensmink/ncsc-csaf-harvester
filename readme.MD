# ğŸ” NCSC Advisory Watcher

Automatisering voor het **ophalen, parseren, dedupliceren en notificeren** van NCSC-advisories.  
Ondersteunt *dagelijkse harvesting*, *severity-filtering* en real-time **Telegram-meldingen** voor relevante risicoâ€™s.

---

## ğŸš€ Functionaliteit

### âœ” Harvester (CSAF + HTML)
`harvest_ncsc.py` haalt advisories op via de officiÃ«le CSAF-feed en een HTML-fallback.

- Extractie van ID, titel, datum, kans/schade, classificatie, URL
- Dagelijkse CSV-output in `output/daily/`
- Metadata-tracking in `output/last_run.json`

### âœ” Deduplicatie
`dedupe.py` voorkomt dubbele meldingen via `output/seen.json`.

Een advisory wordt genegeerd wanneer:
- Het ID al eerder is gezien
- De datum eerder is verwerkt
- Het niet binnen de severity-filters valt

### âœ” Severity Filtering
Standaard worden alleen meldingen verstuurd met verhoogd risico:

| Kans | Schade | Meldingen |
|------|--------|------------|
| H | H | Ja |
| M | H | Ja |
| H | M | Je |

### âœ” Telegram Notificaties
`notify_ncsc.py` stuurt HTML-geformatteerde meldingen via de Telegram Bot API.

---

## ğŸ“ Bestandsstructuur

```
.
â”œâ”€â”€ scraper.py
â”œâ”€â”€ harvest_ncsc.py
â”œâ”€â”€ notify_ncsc.py
â”œâ”€â”€ dedupe.py
â”œâ”€â”€ output/
â”‚   â”œâ”€â”€ daily/
â”‚   â”‚   â””â”€â”€ YYYY-MM-DD.csv
â”‚   â”œâ”€â”€ last_run.json
â”‚   â””â”€â”€ seen.json
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/
â”‚       â””â”€â”€ ncsc.yaml
â””â”€â”€ readme.md
```

---

## ğŸ›  Installatie

### Vereisten
- Python **3.11+**
- Dependencies:

```bash
pip install requests beautifulsoup4 python-dateutil
```

---

## âš™ Configuratie

### Telegram Secrets

| Variabele | Beschrijving |
|-----------|--------------|
| `TELEGRAM_BOT_TOKEN` | API token van de bot |
| `TELEGRAM_CHAT_ID` | Doel-chat voor meldingen |

---

## â–¶ Gebruik

### Harvester + notificaties
```bash
python3 scraper.py
```

### Individuele functies
```bash
python3 harvest_ncsc.py
python3 notify_ncsc.py
```

---

## ğŸ•’ GitHub Actions Workflow

Workflow: `.github/workflows/ncsc.yaml`

- Draait elk uur op werkdagen  
- Weekend- en avondruns  
- Self-hosted runner  
- CSV/JSON output commit  
- Telegram-meldingen  

---

## ğŸ“¤ Output

### CSV
`output/daily/<YYYY-MM-DD>.csv`

### Metadata
`output/last_run.json`

### Deduplication
`output/seen.json`

---

## âš  Limitaties

- Geen retry-mechanisme  
- HTML-fallback gevoelig voor NCSC-layout wijzigingen  
- requirements.txt ontbreekt  
- Geen tests  

---

## ğŸ“„ Licentie
MIT License.

---

## ğŸ‘¤ Maintainer
**Koen Smink**  
https://github.com/koensmink
